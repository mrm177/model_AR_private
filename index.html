<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    html,body{margin:0;height:100%}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell}
    model-viewer{
      width:100%; height:90vh; background:#f5f5f7;
      --progress-bar-height: 4px;
      --progress-bar-color: rgba(0,0,0,.85);
    }
    model-viewer::part(progress-bar){
      position:absolute; top:8px; bottom:auto; left:50%;
      transform:translateX(-50%); width:60%;
    }
    model-viewer::part(ar-button){
      position:absolute; right:16px; bottom:16px;
      padding:10px 14px; border-radius:12px; background:#fff; border:1px solid #ddd;
      font:600 14px/1 system-ui;
      box-shadow:0 2px 12px rgba(0,0,0,.12);
    }
    .links{
      display:flex; gap:16px; padding:12px 16px; flex-wrap:wrap;
    }
    .links a{
      display:inline-block; padding:10px 14px; border-radius:12px; background:#fff;
      border:1px solid #ddd; text-decoration:none; color:#111; font-weight:600;
      box-shadow:0 2px 12px rgba(0,0,0,.06);
    }
  </style>
</head>
<body>
  <!-- Hard AR links -->
  <div class="links">
    <a id="ar-android" href="#">Open in AR (Android)</a>
    <a id="ar-ios" rel="ar" href="#">Open in AR (iOS)</a>
  </div>

  <model-viewer
    id="mv"
    src="model.glb"
    ios-src="model.usdz"
    ar
    ar-modes="scene-viewer webxr quick-look"
    camera-controls
    shadow-intensity="1">
  </model-viewer>

  <script>
    (function () {
      // Build absolute URLs so Scene Viewer / Quick Look can fetch the model
      const glbUrl  = new URL('model.glb',  location.href).toString();
      const usdzUrl = new URL('model.usdz', location.href).toString();

      // Update model-viewer to use absolute URLs as well (helps on iOS)
      const mv = document.getElementById('mv');
      mv.src = glbUrl;
      mv.setAttribute('ios-src', usdzUrl);

      // Scene Viewer HTTP URL (fallback if intent isnâ€™t supported)
      const sceneViewerHttp = `https://arvr.google.com/scene-viewer/1.0?file=${encodeURIComponent(glbUrl)}&mode=ar_preferred&title=${encodeURIComponent('Model')}`;

      // Android intent deep link (recommended)
      const intentUrl =
        `intent://arvr.google.com/scene-viewer/1.0?file=${encodeURIComponent(glbUrl)}&mode=ar_preferred&title=${encodeURIComponent('Model')}` +
        `#Intent;scheme=https;package=com.google.ar.core;action=android.intent.action.VIEW;` +
        `S.browser_fallback_url=${encodeURIComponent(sceneViewerHttp)};end;`;

      // Wire up buttons
      const aAndroid = document.getElementById('ar-android');
      const aIos     = document.getElementById('ar-ios');

      const isAndroid = /Android/i.test(navigator.userAgent);

      aAndroid.href = isAndroid ? intentUrl : sceneViewerHttp; // works on Android, decent fallback elsewhere
      aIos.href = usdzUrl; // Quick Look needs a direct HTTPS link to the .usdz
    })();
  </script>
</body>
</html>
